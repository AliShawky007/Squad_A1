/**********************************************************************************************************************
 *  FILE DESCRIPTION
 *  -----------------------------------------------------------------------------------------------------------------*/
/**        \file  Calculator_Core.c
 *        \brief  perform Calculator operations 
 *		  \Created: 8/17/2023 4:41:52 PM
 *		  \Author: Ahmed Essam
 *		  \details 
**********************************************************************************************************************
 *  INCLUDES
 *********************************************************************************************************************/
#include "Calculator_Core.h"
/**********************************************************************************************************************
*  LOCAL MACROS CONSTANT\FUNCTION
*********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL DATA 
 *********************************************************************************************************************/
uint8 Button_val=0 , operation[10] = {0} , i = 0 , cnt = 0;
sint32 Value[10]={0};
/**********************************************************************************************************************
 *  GLOBAL DATA
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTION PROTOTYPES
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTIONS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL FUNCTIONS
 *********************************************************************************************************************/


/******************************************************************************
* \Syntax          : void Calculator(void)      
* \Description     : perform Calculator operations                                  
*                                                                             
* \Sync\Async      : Synchronous                                               
* \Reentrancy      : Non Reentrant                                             
* \Parameters (in) : parameterName   Parameter Describtion                     
* \Parameters (out): None                                                      
* \Return value:   : void  E_OK
*                                    E_NOT_OK                                  
*******************************************************************************/
 void Calculator(void)
 {
	 LCD_Init();
	 KEYPAD_Init();
	 while (1)
	 {
		 Button_val = KEYPAD_GetValule();
		 if ( Button_val > 47 && Button_val <58 )
		 {
			 Value[cnt] = ((Value[cnt]*10) + (Button_val-48));
			 LCD_WriteInteger(Button_val-48);
		 }
		 else if (Button_val == '=' || Button_val == 'C')
		 {
			 if (Button_val == '=')
			 {
				 LCD_GoTo(1,0);
				 LCD_WriteChar('=');
				 
				 for (i=0;i<=cnt;i++)
				 {
					 switch (operation[i])
					 {						 
						 case '*' :
						 Value[i+1] *= Value[i];
						 if (operation[i-1]=='-') operation[i] = '-';
						 else operation[i] = '+';
						 Value[i] = 0;
						 break;
						 
						 case '/':
						 Value[i+1] = Value[i] / Value[i+1];
						 if (operation[i-1]=='-') operation[i] = '-';
						 else operation[i] = '+';
						 Value[i] = 0;
						 break;
						 
						 default:
						 break;
					 }
				 }
				 
				 
				 for (i=0;i<=cnt;i++)
				 {
					 switch (operation[i])
					 {
						 case '+':
						 Value[0]+=Value[i+1];
						 break;
						 case '-':
						 Value[0]-=Value[i+1];
						 break;
						 
						 default:
						 break;
					 }
				 }
				 LCD_WriteInteger(Value[0]);
			 }
			 else
			 {
				 for (i=0;i<=cnt;i++)
				 {
					 Value[i]=0;
					 operation[i]=0;
				 }
				 LCD_WriteClear();
				 LCD_GoTo(0,0);
				 cnt=0;
			 }
		 }
		 else if (Button_val != 0)
		 {
			 operation[cnt] = Button_val;
			 LCD_WriteChar(operation[cnt]);
			 cnt++;
		 }
	 }
}
 /**********************************************************************************************************************
 *  END OF FILE: Calculator_Core.c
 *********************************************************************************************************************/
